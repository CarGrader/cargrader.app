<!-- cargrader.app/templates/_header.html -->
<header class="site-header site-header--brand">
  <nav class="site-nav">
    <div class="header-inner">
      <!-- Left: Brand -->
      <a class="brand" href="/" aria-label="CarGrader Home">
        <img class="brand__logo"
             src="{{ url_for('static', filename='img/logo-long.svg') }}"
             onerror="this.src='{{ url_for('static', filename='img/logo-long.png') }}'"
             alt="CarGrader">
      </a>

      <!-- Right: Actions -->
      <div class="header-actions">
        <a class="link-signin" href="{{ url_for('billing.account') }}">Login</a>
        <button class="icon-button" id="menuBtn" type="button" aria-label="Open menu" aria-expanded="false" aria-controls="menuPanel">
          <img src="{{ url_for('static', filename='img/icons/menu.svg') }}" alt="" aria-hidden="true" class="icon-20">
        </button>

        <!-- Flyout menu -->
        <div class="menu-panel" id="menuPanel" role="menu" aria-hidden="true">
          <a class="menu-item" href="/" role="menuitem">Home</a>
          <a class="menu-item" href="{{ url_for('billing.account') }}" role="menuitem">Account</a>
          <a class="menu-item" href="{{ url_for('billing.store') }}" role="menuitem">Store</a>
          <a class="menu-item" href="{{ url_for('pages.about') }}" role="menuitem">About</a>
        </div>
      </div>
    </div>
  </nav>

  <!-- Keep your existing inlined JS for toggling, adapted to new DOM -->
  <script>
  (function(){
    const btn   = document.getElementById('menuBtn');
    const panel = document.getElementById('menuPanel');
    if (!btn || !panel) return;        // ✅ guard if markup changes

    let open = false;

    function openPanel(){
      panel.classList.add('open');
      panel.setAttribute('aria-hidden','false');
      btn.setAttribute('aria-expanded','true');
      document.addEventListener('click', onDocClick);
      document.addEventListener('keydown', onKey);
      open = true;
    }
    function closePanel(){
      panel.classList.remove('open');
      panel.setAttribute('aria-hidden','true');
      btn.setAttribute('aria-expanded','false');
      document.removeEventListener('click', onDocClick);
      document.removeEventListener('keydown', onKey);
      open = false;
    }
    function togglePanel(){ open ? closePanel() : openPanel(); }

    function onDocClick(e){
      // ✅ treat clicks on the IMG *inside* the button as "on the button"
      if (!panel.contains(e.target) && !btn.contains(e.target)) {
        closePanel();
      }
    }
    function onKey(e){ if (e.key === 'Escape') closePanel(); }

    btn.addEventListener('click', function(e){
      e.preventDefault();
      togglePanel();
    });
  })();
</script>
</header>
